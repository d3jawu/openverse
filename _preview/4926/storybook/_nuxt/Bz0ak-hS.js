import{_ as pe}from"./C7ap0NCC.js";import{_ as me}from"./CWKBBmmQ.js";import{f as ve}from"./Xs_VBmP5.js";import{f as he}from"./BllLUjK0.js";import{u as be}from"./DZjlKxoF.js";import{u as ge,a as Se}from"./DQej5_ef.js";import{a as p,w as R,b}from"./BGFP1kuB.js";import{o as xe}from"./BaD6kt_k.js";import{e as D,g as we,a as _e}from"./DQnMOLSw.js";import{u as ye}from"./gEJdwIBZ.js";import{u as Ce}from"./nePw-vMe.js";import{u as ke}from"./BNp_2Fah.js";import{u as Ie}from"./DKeW2LvZ.js";import{u as Re,a as Te}from"./D8ABh0bF.js";import{C as Be,R as $e}from"./-TaKdCZx.js";import{s as Ee}from"./BOX21o1p.js";import{_ as Fe}from"./RoKdHXFU.js";import{_ as Ve}from"./DkV6YJSQ.js";import{_ as Ae}from"./BhUgIpXk.js";import{_ as Ke}from"./DmjChvEw.js";import{V as P}from"./BLHYS2vx.js";import{d as Me,S as s,z as g,W as H,H as Ne,I as T,J as Oe,U as t,K as m,E as c,L as De,P as Pe,Q as He,A as Le,C as L,M as qe,D as q,p as ze}from"./DIRjBTfL.js";const Ge=["placeholder","value","aria-label","aria-expanded","aria-activedescendant"],ht=Me({__name:"VHeaderMobile",emits:["open","close"],setup(Je,{emit:z}){const d=s(null),S=s(null),x=s(null),B=s(null),G=g(()=>{var e;return((e=B.value)==null?void 0:e.$el)??void 0}),J=s(null),Q=Re(),U=Te(),u=s(!1),r=s(!1),w=s(!1),W=g(()=>U.appliedFilterCount),$=g(()=>Q.fetchState.isFetching),_=s({start:0,end:0}),{$sendCustomEvent:j}=be(),{updateSearchState:X,searchTerm:f,searchStatus:E}=Ce(j),o=s(f.value),F=()=>{const e=d.value;D(e),e.selectionStart=_.value.start,e.selectionEnd=_.value.end},Y=()=>{o.value&&o.value!==f.value&&(f.value=o.value),y(),V()},V=()=>{window.scrollTo({top:0,left:0,behavior:"auto"}),X()},A=()=>{r.value=!0,u.value=!0,n.value||oe()},v=()=>{r.value=!1,u.value=!1},K=()=>{const e=d.value,a=e.value.length>0?e.value.length-1:0;_.value={start:e.selectionStart??a,end:e.selectionEnd??a}},Z=()=>{o.value=d.value.value,K(),r.value&&!u.value&&A()},ee=()=>{o.value="",F()},{handleKeydown:M,handleSelect:te,handleClear:ae,recent:{isVisible:n,show:oe,hide:y,entries:ne,selectedIdx:C}}=Ie({focusInput:F,term:o,isMobile:!0,isInputFocused:r});H(n,e=>{e||(v(),o.value!==f.value&&(f.value=o.value,V()))});const se=()=>r.value=!0,le=()=>{!n.value&&r.value&&v()};xe(S,e=>{var l,h;((h=(l=x.value)==null?void 0:l.$el)==null?void 0:h.contains(e.target))||(r.value=!1)});const re=()=>{u.value||(K(),A())},k=e=>{y(),ze().then(()=>{const a=e==="forward"?document.getElementById(Ee):we(document.body)[1];D(a??_e(document.body))})},ie=z,{close:N,onTriggerClick:ce,triggerA11yProps:ue}=ye({id:Be,visibleRef:w,nodeRef:S,lockBodyScroll:!0,emit:ie}),I=ge(),de=g(()=>ve(I==null?void 0:I.query.q));H(de,e=>{o.value=e??""});const{doneHydrating:fe}=ke();Se().beforeEach((e,a,l)=>{e.path!==a.path&&(N(),v()),l()});const O=(e,a)=>{var l;n.value?(e.preventDefault(),he((l=x.value)==null?void 0:l.$el,1)):a==="content-settings"&&k("forward")};return(e,a)=>{const l=pe,h=me;return q(),Ne("header",{ref_key:"headerRef",ref:S,class:"main-header z-30 flex w-full items-center px-6 py-4"},[T("form",{action:"/search",class:He(["search-bar group flex h-12 w-full flex-row items-center overflow-hidden rounded-sm",u.value||r.value?"bg-default ring ring-pink-8":"bg-surface"]),onSubmit:b(Y,["prevent"])},[Oe(e.$slots,"start",{},()=>[m(c(Fe,{"is-fetching":$.value,class:"focus-visible:me-1.5px focus-visible:ms-1.5px focus-visible:!h-[45px] focus-visible:max-w-[45px]"},null,8,["is-fetching"]),[[p,!t(n)]]),m(c(P,{icon:"chevron-back",label:e.$t("header.backButton"),"rtl-flip":!0,variant:"filled-gray",onClick:t(y),onKeydown:a[0]||(a[0]=R(b(i=>k("backward"),["shift"]),["tab"]))},null,8,["label","onClick"]),[[p,t(n)]])]),T("input",{id:"search-bar",ref_key:"searchInputRef",ref:d,name:"q",placeholder:e.$t("hero.search.placeholder"),type:"search",class:"search-field ms-1 h-full w-full flex-grow appearance-none rounded-none border-tx bg-tx text-2xl text-secondary placeholder-gray-8 hover:text-default hover:placeholder-gray-12 focus-visible:outline-none",value:o.value,"aria-label":e.$t("search.searchBarLabel",{openverse:"Openverse"}),autocomplete:"off",role:"combobox","aria-autocomplete":"list","aria-expanded":t(n)?"true":"false","aria-controls":"recent-searches-list","aria-haspopup":"listbox","aria-activedescendant":t(C)===void 0?void 0:`option-${t(C)}`,onInput:Z,onKeydown:a[1]||(a[1]=(...i)=>t(M)&&t(M)(...i)),onFocus:se,onFocusout:le,onClick:re},null,40,Ge),m(c(P,{ref_key:"clearButtonRef",ref:J,icon:"close-small",label:e.$t("browsePage.searchForm.clear"),onClick:ee,onKeydown:a[2]||(a[2]=R(b(i=>O(i,"clear-input"),["exact"]),["tab"]))},null,8,["label"]),[[p,t(n)&&o.value]]),m(T("span",{class:"info mx-4 hidden whitespace-nowrap text-xs group-hover:text-default group-focus:text-default md:flex"},De(t(E)),513),[[p,!u.value&&t(E)]]),m(c(Ae,Pe({ref_key:"contentSettingsButtonRef",ref:B,"is-pressed":w.value,"applied-filter-count":W.value},t(ue),{disabled:!t(fe),onClick:t(ce),onKeydown:a[3]||(a[3]=R(b(i=>O(i,"content-settings"),["exact"]),["tab"]))}),null,16,["is-pressed","applied-filter-count","disabled","onClick"]),[[p,!t(n)]]),c(Ve,{variant:"two-thirds",visible:w.value,"is-fetching":$.value,close:t(N),"trigger-element":G.value,labelledby:"content-settings-button"},null,8,["visible","is-fetching","close","trigger-element"])],34),t(n)?(q(),Le(h,{key:0,id:t($e),visible:!0,hide:v,"trigger-element":d.value,"trap-focus":!1,"auto-focus-on-show":!1,"auto-focus-on-hide":!1,"content-classes":"px-3","aria-label":e.$t("recentSearches.heading"),variant:"mobile-input"},{default:L(()=>[c(l,null,{default:L(()=>[c(Ke,{ref_key:"recentSearchesRef",ref:x,class:"w-[100dvw] px-3","selected-idx":t(C),entries:t(ne),bordered:!1,onSelect:t(te),onClear:t(ae),onLastTab:a[4]||(a[4]=i=>k("forward"))},null,8,["selected-idx","entries","onSelect","onClear"])]),_:1})]),_:1},8,["id","trigger-element","aria-label"])):qe("",!0)],512)}}});export{ht as _};
